# Test configuration
find_package(Boost REQUIRED COMPONENTS unit_test_framework)

# Helper function for creating test executables
function(add_network_test test_name source_file)
    add_executable(${test_name} ${source_file})
    target_link_libraries(${test_name} PRIVATE
        network_simulator
        Boost::unit_test_framework
    )
    if(TARGET Folly::folly)
        target_link_libraries(${test_name} PRIVATE Folly::folly)
    endif()
    target_compile_features(${test_name} PRIVATE cxx_std_23)
    
    # Add test to CTest
    add_test(NAME ${test_name} COMMAND ${test_name})
endfunction()

# Helper function for creating Raft completion test executables with additional dependencies
function(add_raft_completion_test test_name source_file)
    add_executable(${test_name} ${source_file})
    target_link_libraries(${test_name} PRIVATE
        network_simulator
        Boost::unit_test_framework
        boost_json
    )
    if(TARGET Folly::folly)
        target_link_libraries(${test_name} PRIVATE Folly::folly)
    endif()
    target_compile_features(${test_name} PRIVATE cxx_std_23)
    
    # Add test to CTest
    add_test(NAME ${test_name} COMMAND ${test_name})
endfunction()

# Test files
add_network_test(concept_test concept_test.cpp)
add_network_test(folly_concept_compilation_property_test folly_concept_compilation_property_test.cpp)
add_network_test(future_factory_concept_test future_factory_concept_test.cpp)
add_network_test(folly_semi_promise_concept_compliance_test folly_semi_promise_concept_compliance_test.cpp)
add_network_test(kythira_semi_promise_concept_compliance_property_test kythira_semi_promise_concept_compliance_property_test.cpp)
add_network_test(kythira_promise_concept_compliance_property_test kythira_promise_concept_compliance_property_test.cpp)
add_network_test(kythira_promise_future_retrieval_property_test kythira_promise_future_retrieval_property_test.cpp)
add_network_test(kythira_semi_promise_value_exception_handling_property_test kythira_semi_promise_value_exception_handling_property_test.cpp)
add_network_test(folly_promise_concept_compliance_test folly_promise_concept_compliance_test.cpp)
add_network_test(folly_executor_concept_compliance_property_test folly_executor_concept_compliance_property_test.cpp)
add_network_test(kythira_executor_concept_compliance_property_test kythira_executor_concept_compliance_property_test.cpp)
add_network_test(kythira_executor_work_submission_property_test kythira_executor_work_submission_property_test.cpp)
add_network_test(folly_future_concept_compliance_property_test folly_future_concept_compliance_property_test.cpp)

# State machine tests
add_raft_completion_test(state_machine_snapshot_round_trip_property_test state_machine_snapshot_round_trip_property_test.cpp)
add_raft_completion_test(state_machine_idempotency_property_test state_machine_idempotency_property_test.cpp)
add_raft_completion_test(state_machine_determinism_property_test state_machine_determinism_property_test.cpp)
add_raft_completion_test(state_machine_performance_benchmark state_machine_performance_benchmark.cpp)
add_raft_completion_test(state_machine_apply_performance_property_test state_machine_apply_performance_property_test.cpp)
add_network_test(kythira_future_concept_compliance_test kythira_future_concept_compliance_test.cpp)
add_network_test(kythira_future_concept_compliance_property_test kythira_future_concept_compliance_property_test.cpp)
add_network_test(try_concept_requirements_property_test try_concept_requirements_property_test.cpp)
add_network_test(semi_promise_concept_requirements_property_test semi_promise_concept_requirements_property_test.cpp)
add_network_test(promise_concept_inheritance_property_test promise_concept_inheritance_property_test.cpp)
add_network_test(executor_concept_requirements_property_test executor_concept_requirements_property_test.cpp)
add_network_test(keep_alive_concept_requirements_property_test keep_alive_concept_requirements_property_test.cpp)
add_network_test(kythira_keep_alive_concept_compliance_property_test kythira_keep_alive_concept_compliance_property_test.cpp)
add_network_test(kythira_keep_alive_pointer_access_property_test kythira_keep_alive_pointer_access_property_test.cpp)
add_network_test(kythira_future_factory_concept_compliance_property_test kythira_future_factory_concept_compliance_property_test.cpp)
add_network_test(kythira_future_factory_creation_property_test kythira_future_factory_creation_property_test.cpp)
add_network_test(kythira_future_collector_concept_compliance_property_test kythira_future_collector_concept_compliance_property_test.cpp)
add_network_test(kythira_future_collector_collection_operations_property_test kythira_future_collector_collection_operations_property_test.cpp)
add_network_test(kythira_future_continuation_operations_property_test kythira_future_continuation_operations_property_test.cpp)
add_network_test(kythira_future_transformation_operations_property_test kythira_future_transformation_operations_property_test.cpp)
add_network_test(future_then_try_future_returning_callback_property_test future_then_try_future_returning_callback_property_test.cpp)
add_network_test(future_then_error_future_returning_callback_property_test future_then_error_future_returning_callback_property_test.cpp)
add_network_test(future_void_specialization_future_returning_callback_test future_void_specialization_future_returning_callback_test.cpp)
add_network_test(void_future_demo void_future_demo.cpp)
add_network_test(future_concept_requirements_property_test future_concept_requirements_property_test.cpp)
add_network_test(executor_attachment_support_property_test executor_attachment_support_property_test.cpp)
add_network_test(folly_concept_wrappers_comprehensive_compliance_property_test folly_concept_wrappers_comprehensive_compliance_property_test.cpp)
add_network_test(folly_concept_wrappers_generic_template_compatibility_property_test folly_concept_wrappers_generic_template_compatibility_property_test.cpp)
add_network_test(folly_concept_wrappers_backward_compatibility_property_test folly_concept_wrappers_backward_compatibility_property_test.cpp)
add_network_test(folly_concept_wrappers_interoperability_property_test folly_concept_wrappers_interoperability_property_test.cpp)
add_network_test(folly_concept_wrappers_exception_safety_property_test folly_concept_wrappers_exception_safety_property_test.cpp)
add_network_test(folly_concept_wrappers_unit_test folly_concept_wrappers_unit_test.cpp)
add_network_test(missing_wrapper_functionality_unit_test missing_wrapper_functionality_unit_test.cpp)
add_network_test(wrapper_interop_utilities_unit_test wrapper_interop_utilities_unit_test.cpp)
add_network_test(folly_concept_wrappers_integration_test folly_concept_wrappers_integration_test.cpp)
add_network_test(timeout_operation_support_property_test timeout_operation_support_property_test.cpp)
add_network_test(future_test future_test.cpp)
add_network_test(future_concept_compliance_property_test future_concept_compliance_property_test.cpp)
add_network_test(core_implementation_genericity_property_test core_implementation_genericity_property_test.cpp)
add_network_test(core_implementation_namespace_property_test core_implementation_namespace_property_test.cpp)
add_network_test(network_concept_compliance_property_test network_concept_compliance_property_test.cpp)
add_network_test(network_simulator_return_types_property_test network_simulator_return_types_property_test.cpp)
add_network_test(simulator_test simulator_test.cpp)
add_network_test(simulator_property_test simulator_property_test.cpp)
add_network_test(network_simulator_core_unit_test network_simulator_core_unit_test.cpp)
add_network_test(network_simulator_topology_edge_latency_preservation_property_test network_simulator_topology_edge_latency_preservation_property_test.cpp)
add_network_test(network_simulator_topology_edge_reliability_preservation_property_test network_simulator_topology_edge_reliability_preservation_property_test.cpp)
add_network_test(network_simulator_topology_management_property_test network_simulator_topology_management_property_test.cpp)
add_network_test(network_simulator_lifecycle_control_property_test network_simulator_lifecycle_control_property_test.cpp)
add_network_test(network_simulator_reset_property_test network_simulator_reset_property_test.cpp)
add_network_test(network_node_send_success_property_test network_node_send_success_property_test.cpp)
add_network_test(network_node_send_timeout_property_test network_node_send_timeout_property_test.cpp)
add_network_test(network_node_send_non_delivery_property_test network_node_send_non_delivery_property_test.cpp)
add_network_test(network_node_receive_message_property_test network_node_receive_message_property_test.cpp)
add_network_test(network_node_receive_timeout_property_test network_node_receive_timeout_property_test.cpp)
add_network_test(network_simulator_connection_establishment_timeout_property_test network_simulator_connection_establishment_timeout_property_test.cpp)
add_network_test(network_simulator_connection_establishment_cancellation_property_test network_simulator_connection_establishment_cancellation_property_test.cpp)
add_network_test(network_simulator_connection_pool_reuse_property_test network_simulator_connection_pool_reuse_property_test.cpp)
add_network_test(network_simulator_connection_pool_eviction_property_test network_simulator_connection_pool_eviction_property_test.cpp)
add_network_test(network_simulator_connection_pool_cleanup_property_test network_simulator_connection_pool_cleanup_property_test.cpp)
add_network_test(network_simulator_listener_resource_cleanup_property_test network_simulator_listener_resource_cleanup_property_test.cpp)
add_network_test(network_simulator_listener_port_release_property_test network_simulator_listener_port_release_property_test.cpp)
add_network_test(network_simulator_connection_state_tracking_property_test network_simulator_connection_state_tracking_property_test.cpp)
add_network_test(network_simulator_connection_state_updates_property_test network_simulator_connection_state_updates_property_test.cpp)
add_network_test(network_simulator_connection_resource_cleanup_property_test network_simulator_connection_resource_cleanup_property_test.cpp)
add_network_test(integration_test integration_test.cpp)
add_network_test(network_simulator_client_server_integration_test network_simulator_client_server_integration_test.cpp)
add_network_test(network_simulator_simple_integration_test network_simulator_simple_integration_test.cpp)
add_network_test(network_simulator_multi_node_topology_integration_test network_simulator_multi_node_topology_integration_test.cpp)
add_network_test(network_simulator_concurrent_operations_integration_test network_simulator_concurrent_operations_integration_test.cpp)
add_network_test(network_simulator_connection_management_integration_test network_simulator_connection_management_integration_test.cpp)
add_network_test(network_simulator_different_types_integration_test network_simulator_different_types_integration_test.cpp)
add_network_test(test_code_future_usage_property_test test_code_future_usage_property_test.cpp)
add_network_test(header_include_consistency_property_test header_include_consistency_property_test.cpp)
add_network_test(future_usage_consistency_property_test future_usage_consistency_property_test.cpp)
add_network_test(complete_conversion_validation_property_test complete_conversion_validation_property_test.cpp)
add_network_test(type_conversion_property_test type_conversion_property_test.cpp)
add_network_test(build_success_property_test build_success_property_test.cpp)
add_network_test(behavioral_preservation_property_test behavioral_preservation_property_test.cpp)
add_network_test(performance_benchmark_test performance_benchmark_test.cpp)
add_network_test(performance_equivalence_property_test performance_equivalence_property_test.cpp)
add_network_test(future_test_utilities_test future_test_utilities_test.cpp)
add_network_test(generic_future_concept_validation_test generic_future_concept_validation_test.cpp)

# Raft tests
add_network_test(raft_types_test raft_types_test.cpp)
add_network_test(raft_state_machine_concept_test raft_state_machine_concept_test.cpp)
add_network_test(persistence_concept_test persistence_concept_test.cpp)
add_network_test(persistence_round_trip_property_test persistence_round_trip_property_test.cpp)
add_network_test(raft_follower_acknowledgment_tracking_property_test raft_follower_acknowledgment_tracking_property_test.cpp)
add_network_test(raft_majority_commit_index_advancement_property_test raft_majority_commit_index_advancement_property_test.cpp)
add_network_test(raft_non_blocking_slow_followers_property_test raft_non_blocking_slow_followers_property_test.cpp)
add_network_test(raft_unresponsive_follower_handling_property_test raft_unresponsive_follower_handling_property_test.cpp)
add_network_test(raft_leader_self_acknowledgment_property_test raft_leader_self_acknowledgment_property_test.cpp)

# Raft completion property tests - commit waiting mechanism
add_raft_completion_test(raft_commit_waiting_completion_property_test raft_commit_waiting_completion_property_test.cpp)

# Raft completion property tests - state machine application
add_raft_completion_test(raft_application_failure_handling_property_test raft_application_failure_handling_property_test.cpp)
add_raft_completion_test(raft_application_success_handling_property_test raft_application_success_handling_property_test.cpp)
add_raft_completion_test(raft_applied_index_catchup_property_test raft_applied_index_catchup_property_test.cpp)
add_raft_completion_test(raft_batch_entry_application_property_test raft_batch_entry_application_property_test.cpp)

# Raft completion property tests - future collection mechanism
add_raft_completion_test(raft_heartbeat_majority_collection_property_test raft_heartbeat_majority_collection_property_test.cpp)
add_raft_completion_test(raft_election_vote_collection_property_test raft_election_vote_collection_property_test.cpp)
add_raft_completion_test(raft_replication_majority_acknowledgment_property_test raft_replication_majority_acknowledgment_property_test.cpp)
add_raft_completion_test(raft_timeout_handling_collections_property_test raft_timeout_handling_collections_property_test.cpp)
add_raft_completion_test(raft_collection_cancellation_cleanup_property_test raft_collection_cancellation_cleanup_property_test.cpp)

# Raft completion property tests - error handling mechanism
add_raft_completion_test(error_handler_exponential_backoff_unit_test error_handler_exponential_backoff_unit_test.cpp)
add_raft_completion_test(error_handler_async_retry_property_test error_handler_async_retry_property_test.cpp)
add_raft_completion_test(raft_heartbeat_retry_backoff_property_test raft_heartbeat_retry_backoff_property_test.cpp)
add_raft_completion_test(raft_append_entries_retry_handling_property_test raft_append_entries_retry_handling_property_test.cpp)
add_raft_completion_test(raft_snapshot_transfer_retry_property_test raft_snapshot_transfer_retry_property_test.cpp)
add_raft_completion_test(raft_vote_request_failure_handling_property_test raft_vote_request_failure_handling_property_test.cpp)
add_raft_completion_test(raft_partition_detection_handling_property_test raft_partition_detection_handling_property_test.cpp)
add_raft_completion_test(raft_timeout_classification_property_test raft_timeout_classification_property_test.cpp)

# Raft completion property tests - linearizable reads
add_raft_completion_test(raft_read_linearizability_verification_property_test raft_read_linearizability_verification_property_test.cpp)
add_raft_completion_test(raft_successful_read_state_return_property_test raft_successful_read_state_return_property_test.cpp)
add_raft_completion_test(raft_failed_read_rejection_property_test raft_failed_read_rejection_property_test.cpp)
add_raft_completion_test(raft_read_abortion_leadership_loss_property_test raft_read_abortion_leadership_loss_property_test.cpp)
add_raft_completion_test(raft_concurrent_read_efficiency_property_test raft_concurrent_read_efficiency_property_test.cpp)

# Raft completion property tests - heartbeat-based read state implementation (Property 80)
add_raft_completion_test(raft_heartbeat_based_read_state_property_test raft_heartbeat_based_read_state_property_test.cpp)

# Raft completion property tests - election vote collection implementation (Property 81)
add_raft_completion_test(raft_election_vote_collection_implementation_property_test raft_election_vote_collection_implementation_property_test.cpp)

# Raft completion property tests - replication acknowledgment collection (Property 82)
add_raft_completion_test(raft_replication_acknowledgment_collection_property_test raft_replication_acknowledgment_collection_property_test.cpp)

# Raft completion property tests - replicate to followers implementation (Property 88)
add_raft_completion_test(raft_replicate_to_followers_property_test raft_replicate_to_followers_property_test.cpp)

# Raft completion property tests - timeout handling in future collections (Property 83)
add_raft_completion_test(raft_timeout_handling_future_collections_property_test raft_timeout_handling_future_collections_property_test.cpp)

# Raft completion property tests - cancellation and cleanup in future collections (Property 84)
add_raft_completion_test(raft_cancellation_cleanup_future_collections_property_test raft_cancellation_cleanup_future_collections_property_test.cpp)

# Raft completion property tests - cancellation and cleanup mechanism
add_raft_completion_test(raft_shutdown_cleanup_property_test raft_shutdown_cleanup_property_test.cpp)
add_raft_completion_test(raft_step_down_operation_cancellation_property_test raft_step_down_operation_cancellation_property_test.cpp)
add_raft_completion_test(raft_timeout_cancellation_cleanup_property_test raft_timeout_cancellation_cleanup_property_test.cpp)
add_raft_completion_test(raft_callback_safety_after_cancellation_property_test raft_callback_safety_after_cancellation_property_test.cpp)
add_raft_completion_test(raft_resource_leak_prevention_property_test raft_resource_leak_prevention_property_test.cpp)

# Raft completion property tests - configurable timeout and retry policies
add_raft_completion_test(raft_rpc_timeout_configuration_property_test raft_rpc_timeout_configuration_property_test.cpp)
add_raft_completion_test(raft_retry_policy_configuration_property_test raft_retry_policy_configuration_property_test.cpp)
add_raft_completion_test(raft_heartbeat_interval_compatibility_property_test raft_heartbeat_interval_compatibility_property_test.cpp)
add_raft_completion_test(raft_adaptive_timeout_behavior_property_test raft_adaptive_timeout_behavior_property_test.cpp)
add_raft_completion_test(raft_configuration_validation_property_test raft_configuration_validation_property_test.cpp)

# Raft completion property tests - comprehensive error reporting and logging
add_raft_completion_test(raft_rpc_error_logging_property_test raft_rpc_error_logging_property_test.cpp)
add_raft_completion_test(raft_commit_timeout_logging_property_test raft_commit_timeout_logging_property_test.cpp)
add_raft_completion_test(raft_configuration_failure_logging_property_test raft_configuration_failure_logging_property_test.cpp)
add_raft_completion_test(raft_collection_error_logging_property_test raft_collection_error_logging_property_test.cpp)
add_raft_completion_test(raft_application_failure_logging_property_test raft_application_failure_logging_property_test.cpp)

# Raft completion property tests - add_server implementation (Property 92)
add_raft_completion_test(raft_add_server_implementation_property_test raft_add_server_implementation_property_test.cpp)

# Raft completion property tests - remove_server implementation (Property 93)
add_raft_completion_test(raft_remove_server_implementation_property_test raft_remove_server_implementation_property_test.cpp)

# HTTP transport tests
add_network_test(http_exceptions_test http_exceptions_test.cpp)
add_network_test(http_config_test http_config_test.cpp)

# CoAP transport tests
add_network_test(coap_transport_initialization_property_test coap_transport_initialization_property_test.cpp)
add_network_test(coap_dtls_handshake_stub_test coap_dtls_handshake_stub_test.cpp)
add_network_test(coap_multicast_operation_return_types_property_test coap_multicast_operation_return_types_property_test.cpp)
add_network_test(memory_pool_basic_test memory_pool_basic_test.cpp)
add_network_test(memory_pool_reset_cleanup_test memory_pool_reset_cleanup_test.cpp)
add_network_test(memory_pool_reset_cleanup_property_test memory_pool_reset_cleanup_property_test.cpp)
add_network_test(memory_pool_metrics_monitoring_test memory_pool_metrics_monitoring_test.cpp)
add_network_test(memory_pool_size_monitoring_property_test memory_pool_size_monitoring_property_test.cpp)
add_network_test(memory_pool_leak_detection_test memory_pool_leak_detection_test.cpp)
add_network_test(memory_pool_leak_detection_property_test memory_pool_leak_detection_property_test.cpp)
add_network_test(memory_pool_leak_detection_debug memory_pool_leak_detection_debug.cpp)

# CoAP libcoap integration test
add_executable(coap_libcoap_integration_test coap_libcoap_integration_test.cpp)
target_link_libraries(coap_libcoap_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_libcoap_integration_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_libcoap_integration_test PRIVATE cxx_std_23)
add_test(NAME coap_libcoap_integration_test COMMAND coap_libcoap_integration_test)
set_tests_properties(coap_libcoap_integration_test PROPERTIES
    TIMEOUT 60
    LABELS "coap;integration;libcoap"
)

# CoAP event logging property test needs Boost.JSON
add_executable(coap_event_logging_property_test coap_event_logging_property_test.cpp)
target_link_libraries(coap_event_logging_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_event_logging_property_test PRIVATE cxx_std_23)
add_test(NAME coap_event_logging_property_test COMMAND coap_event_logging_property_test)

# CoAP configuration test
add_executable(coap_config_test coap_config_test.cpp)
target_link_libraries(coap_config_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
target_compile_features(coap_config_test PRIVATE cxx_std_23)
add_test(NAME coap_config_test COMMAND coap_config_test)
set_tests_properties(coap_config_test PROPERTIES TIMEOUT 60 LABELS "coap;unit")

# CoAP multicast address validation test
add_executable(coap_multicast_address_validation_test coap_multicast_address_validation_test.cpp)
target_link_libraries(coap_multicast_address_validation_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_multicast_address_validation_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_multicast_address_validation_test PRIVATE cxx_std_23)
add_test(NAME coap_multicast_address_validation_test COMMAND coap_multicast_address_validation_test)
set_tests_properties(coap_multicast_address_validation_test PROPERTIES TIMEOUT 30 LABELS "coap;unit")

# CoAP leave multicast group test
add_executable(coap_leave_multicast_group_test coap_leave_multicast_group_test.cpp)
target_link_libraries(coap_leave_multicast_group_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_leave_multicast_group_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_leave_multicast_group_test PRIVATE cxx_std_23)
add_test(NAME coap_leave_multicast_group_test COMMAND coap_leave_multicast_group_test)
set_tests_properties(coap_leave_multicast_group_test PROPERTIES TIMEOUT 30 LABELS "coap;unit;multicast")

# CoAP get joined multicast groups test
add_executable(coap_get_joined_multicast_groups_test coap_get_joined_multicast_groups_test.cpp)
target_link_libraries(coap_get_joined_multicast_groups_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_get_joined_multicast_groups_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_get_joined_multicast_groups_test PRIVATE cxx_std_23)
add_test(NAME coap_get_joined_multicast_groups_test COMMAND coap_get_joined_multicast_groups_test)
set_tests_properties(coap_get_joined_multicast_groups_test PROPERTIES TIMEOUT 30 LABELS "coap;unit;multicast")

# CoAP concept conformance test
add_executable(coap_concept_conformance_test coap_concept_conformance_test.cpp)
target_link_libraries(coap_concept_conformance_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_concept_conformance_test PRIVATE cxx_std_23)
add_test(NAME coap_concept_conformance_test COMMAND coap_concept_conformance_test)

# CoAP message serialization property test needs Boost.JSON
add_executable(coap_message_serialization_property_test coap_message_serialization_property_test.cpp)
target_link_libraries(coap_message_serialization_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_message_serialization_property_test PRIVATE cxx_std_23)
add_test(NAME coap_message_serialization_property_test COMMAND coap_message_serialization_property_test)

# CoAP POST method property test needs Boost.JSON
add_executable(coap_post_method_property_test coap_post_method_property_test.cpp)
target_link_libraries(coap_post_method_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_post_method_property_test PRIVATE cxx_std_23)
add_test(NAME coap_post_method_property_test COMMAND coap_post_method_property_test)

# CoAP future resolution property test needs Boost.JSON
add_executable(coap_future_resolution_property_test coap_future_resolution_property_test.cpp)
target_link_libraries(coap_future_resolution_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_future_resolution_property_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_future_resolution_property_test PRIVATE cxx_std_23)
add_test(NAME coap_future_resolution_property_test COMMAND coap_future_resolution_property_test)

# CoAP Content-Format property test needs Boost.JSON
add_executable(coap_content_format_property_test coap_content_format_property_test.cpp)
target_link_libraries(coap_content_format_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_content_format_property_test PRIVATE cxx_std_23)
add_test(NAME coap_content_format_property_test COMMAND coap_content_format_property_test)

# CoAP confirmable message property test needs Boost.JSON
add_executable(coap_confirmable_message_property_test coap_confirmable_message_property_test.cpp)
target_link_libraries(coap_confirmable_message_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_confirmable_message_property_test PRIVATE cxx_std_23)
add_test(NAME coap_confirmable_message_property_test COMMAND coap_confirmable_message_property_test)
set_tests_properties(coap_confirmable_message_property_test PROPERTIES TIMEOUT 90 LABELS "coap;property")

# CoAP duplicate detection property test needs Boost.JSON
add_executable(coap_duplicate_detection_property_test coap_duplicate_detection_property_test.cpp)
target_link_libraries(coap_duplicate_detection_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_duplicate_detection_property_test PRIVATE cxx_std_23)
add_test(NAME coap_duplicate_detection_property_test COMMAND coap_duplicate_detection_property_test)
set_tests_properties(coap_duplicate_detection_property_test PROPERTIES TIMEOUT 60 LABELS "coap;property")

# CoAP DTLS connection establishment property test needs Boost.JSON
add_executable(coap_dtls_connection_establishment_property_test coap_dtls_connection_establishment_property_test.cpp)
target_link_libraries(coap_dtls_connection_establishment_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_dtls_connection_establishment_property_test PRIVATE cxx_std_23)
add_test(NAME coap_dtls_connection_establishment_property_test COMMAND coap_dtls_connection_establishment_property_test)

# CoAP certificate validation failure property test needs Boost.JSON
add_executable(coap_certificate_validation_failure_property_test coap_certificate_validation_failure_property_test.cpp)
target_link_libraries(coap_certificate_validation_failure_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(coap_certificate_validation_failure_property_test PRIVATE cxx_std_23)
add_test(NAME coap_certificate_validation_failure_property_test COMMAND coap_certificate_validation_failure_property_test)

# HTTP server tests need Boost.JSON
add_executable(http_server_test http_server_test.cpp)
target_link_libraries(http_server_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(http_server_test PRIVATE Folly::folly)
endif()
target_compile_features(http_server_test PRIVATE cxx_std_23)
add_test(NAME http_server_test COMMAND http_server_test)

# HTTP server property tests need Boost.JSON
add_executable(http_server_property_tests http_server_property_tests.cpp)
target_link_libraries(http_server_property_tests PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(http_server_property_tests PRIVATE Folly::folly)
endif()
target_compile_features(http_server_property_tests PRIVATE cxx_std_23)
add_test(NAME http_server_property_tests COMMAND http_server_property_tests)

# HTTP integration tests need Boost.JSON
add_executable(http_integration_test http_integration_test.cpp)
target_link_libraries(http_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(http_integration_test PRIVATE Folly::folly)
endif()
target_compile_features(http_integration_test PRIVATE cxx_std_23)
add_test(NAME http_integration_test COMMAND http_integration_test)

# HTTP client test
add_executable(http_client_test http_client_test.cpp)
target_link_libraries(http_client_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(http_client_test PRIVATE Folly::folly)
endif()
target_compile_features(http_client_test PRIVATE cxx_std_23)
add_test(NAME http_client_test COMMAND http_client_test)

# HTTP client property tests need Boost.JSON
add_executable(http_client_property_tests http_client_property_tests.cpp)
target_link_libraries(http_client_property_tests PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(http_client_property_tests PRIVATE Folly::folly)
endif()
target_compile_features(http_client_property_tests PRIVATE cxx_std_23)
add_test(NAME http_client_property_tests COMMAND http_client_property_tests)

# HTTP transport return types property test
add_executable(http_transport_return_types_property_test http_transport_return_types_property_test.cpp)
target_link_libraries(http_transport_return_types_property_test PRIVATE
    httplib::httplib
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(http_transport_return_types_property_test PRIVATE Folly::folly)
endif()
target_compile_features(http_transport_return_types_property_test PRIVATE cxx_std_23)
add_test(NAME http_transport_return_types_property_test COMMAND http_transport_return_types_property_test)

# HTTP client comprehensive test needs Boost.JSON
add_executable(http_client_comprehensive_test http_client_comprehensive_test.cpp)
target_link_libraries(http_client_comprehensive_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(http_client_comprehensive_test PRIVATE Folly::folly)
endif()
target_compile_features(http_client_comprehensive_test PRIVATE cxx_std_23)
add_test(NAME http_client_comprehensive_test COMMAND http_client_comprehensive_test)

# HTTP client connection test needs Boost.JSON
add_executable(http_client_connection_test http_client_connection_test.cpp)
target_link_libraries(http_client_connection_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(http_client_connection_test PRIVATE Folly::folly)
endif()
target_compile_features(http_client_connection_test PRIVATE cxx_std_23)
add_test(NAME http_client_connection_test COMMAND http_client_connection_test)

# HTTPLib server validation test
add_executable(httplib_server_validation_test httplib_server_validation_test.cpp)
target_link_libraries(httplib_server_validation_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
target_compile_features(httplib_server_validation_test PRIVATE cxx_std_23)
add_test(NAME httplib_server_validation_test COMMAND httplib_server_validation_test)

# HTTPLib basic understanding test
add_executable(httplib_basic_understanding_test httplib_basic_understanding_test.cpp)
target_link_libraries(httplib_basic_understanding_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
target_compile_features(httplib_basic_understanding_test PRIVATE cxx_std_23)
add_test(NAME httplib_basic_understanding_test COMMAND httplib_basic_understanding_test)



# HTTPLib best practices test
add_executable(httplib_best_practices_test httplib_best_practices_test.cpp)
target_link_libraries(httplib_best_practices_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
target_compile_features(httplib_best_practices_test PRIVATE cxx_std_23)
add_test(NAME httplib_best_practices_test COMMAND httplib_best_practices_test)



# RPC serialization property test needs Boost.JSON
add_executable(rpc_serialization_property_test rpc_serialization_property_test.cpp)
target_link_libraries(rpc_serialization_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(rpc_serialization_property_test PRIVATE cxx_std_23)
add_test(NAME rpc_serialization_property_test COMMAND rpc_serialization_property_test)

# RPC serializer concept test needs Boost.JSON
add_executable(rpc_serializer_concept_test rpc_serializer_concept_test.cpp)
target_link_libraries(rpc_serializer_concept_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(rpc_serializer_concept_test PRIVATE cxx_std_23)
add_test(NAME rpc_serializer_concept_test COMMAND rpc_serializer_concept_test)

# RPC malformed message property test needs Boost.JSON
add_executable(rpc_malformed_message_property_test rpc_malformed_message_property_test.cpp)
target_link_libraries(rpc_malformed_message_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
target_compile_features(rpc_malformed_message_property_test PRIVATE cxx_std_23)
add_test(NAME rpc_malformed_message_property_test COMMAND rpc_malformed_message_property_test)

# Network retry property test needs Boost.JSON and Folly
add_executable(network_retry_property_test network_retry_property_test.cpp)
target_link_libraries(network_retry_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(network_retry_property_test PRIVATE Folly::folly)
endif()
target_compile_features(network_retry_property_test PRIVATE cxx_std_23)
add_test(NAME network_retry_property_test COMMAND network_retry_property_test)

add_executable(minimal_network_test minimal_network_test.cpp)
target_link_libraries(minimal_network_test PRIVATE
    network_simulator
    Folly::folly
)
target_compile_features(minimal_network_test PRIVATE cxx_std_23)
add_test(NAME minimal_network_test COMMAND minimal_network_test)
set_tests_properties(minimal_network_test PROPERTIES
    TIMEOUT 30
    LABELS "integration;network"
)

# Logger concept test
add_executable(logger_concept_test logger_concept_test.cpp)
target_link_libraries(logger_concept_test PRIVATE
    network_simulator
)
target_compile_features(logger_concept_test PRIVATE cxx_std_23)

# Console logger test
add_executable(console_logger_test console_logger_test.cpp)
target_link_libraries(console_logger_test PRIVATE
    network_simulator
)
target_compile_features(console_logger_test PRIVATE cxx_std_23)
add_test(NAME console_logger_test COMMAND console_logger_test)

# Metrics concept test
add_executable(metrics_concept_test metrics_concept_test.cpp)
target_link_libraries(metrics_concept_test PRIVATE
    network_simulator
)
target_compile_features(metrics_concept_test PRIVATE cxx_std_23)

# No-op metrics test
add_executable(noop_metrics_test noop_metrics_test.cpp)
target_link_libraries(noop_metrics_test PRIVATE
    network_simulator
)
target_compile_features(noop_metrics_test PRIVATE cxx_std_23)
add_test(NAME noop_metrics_test COMMAND noop_metrics_test)

# No-op metrics template test
add_executable(noop_metrics_template_test noop_metrics_template_test.cpp)
target_link_libraries(noop_metrics_template_test PRIVATE
    network_simulator
)
target_compile_features(noop_metrics_template_test PRIVATE cxx_std_23)
add_test(NAME noop_metrics_template_test COMMAND noop_metrics_template_test)

# Membership manager concept test
add_executable(membership_concept_test membership_concept_test.cpp)
target_link_libraries(membership_concept_test PRIVATE
    network_simulator
)
target_compile_features(membership_concept_test PRIVATE cxx_std_23)
add_test(NAME membership_concept_test COMMAND membership_concept_test)

# Default membership manager test
add_executable(default_membership_manager_test default_membership_manager_test.cpp)
target_link_libraries(default_membership_manager_test PRIVATE
    network_simulator
)
target_compile_features(default_membership_manager_test PRIVATE cxx_std_23)
add_test(NAME default_membership_manager_test COMMAND default_membership_manager_test)

# Raft configuration concept test
add_executable(raft_configuration_concept_test raft_configuration_concept_test.cpp)
target_link_libraries(raft_configuration_concept_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
target_compile_features(raft_configuration_concept_test PRIVATE cxx_std_23)
add_test(NAME raft_configuration_concept_test COMMAND raft_configuration_concept_test)

# Raft get_log_entry test
add_executable(raft_get_log_entry_test raft_get_log_entry_test.cpp)
target_link_libraries(raft_get_log_entry_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_get_log_entry_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_get_log_entry_test PRIVATE cxx_std_23)
add_test(NAME raft_get_log_entry_test COMMAND raft_get_log_entry_test)
set_tests_properties(raft_get_log_entry_test PROPERTIES
    TIMEOUT 30
    LABELS "unit;raft"
)

# Complete RequestVote handler property test
add_executable(raft_complete_request_vote_handler_property_test raft_complete_request_vote_handler_property_test.cpp)
target_link_libraries(raft_complete_request_vote_handler_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_complete_request_vote_handler_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_complete_request_vote_handler_property_test PRIVATE cxx_std_23)
add_test(NAME raft_complete_request_vote_handler_property_test COMMAND raft_complete_request_vote_handler_property_test)
set_tests_properties(raft_complete_request_vote_handler_property_test PROPERTIES
    TIMEOUT 120
    LABELS "property;raft;vote;election"
)

# Complete AppendEntries handler property test
add_executable(raft_complete_append_entries_handler_property_test raft_complete_append_entries_handler_property_test.cpp)
target_link_libraries(raft_complete_append_entries_handler_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_complete_append_entries_handler_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_complete_append_entries_handler_property_test PRIVATE cxx_std_23)
add_test(NAME raft_complete_append_entries_handler_property_test COMMAND raft_complete_append_entries_handler_property_test)
set_tests_properties(raft_complete_append_entries_handler_property_test PROPERTIES
    TIMEOUT 120
    LABELS "property;raft;append_entries;replication"
)

# Submit command with timeout property test
add_executable(raft_submit_command_timeout_property_test raft_submit_command_timeout_property_test.cpp)
target_link_libraries(raft_submit_command_timeout_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_submit_command_timeout_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_submit_command_timeout_property_test PRIVATE cxx_std_23)
add_test(NAME raft_submit_command_timeout_property_test COMMAND raft_submit_command_timeout_property_test)
set_tests_properties(raft_submit_command_timeout_property_test PROPERTIES
    TIMEOUT 120
    LABELS "property;raft;submit_command;timeout;commit_waiter"
)

# InstallSnapshot handler unit test
add_executable(raft_install_snapshot_handler_test raft_install_snapshot_handler_test.cpp)
target_link_libraries(raft_install_snapshot_handler_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_install_snapshot_handler_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_install_snapshot_handler_test PRIVATE cxx_std_23)
add_test(NAME raft_install_snapshot_handler_test COMMAND raft_install_snapshot_handler_test)
set_tests_properties(raft_install_snapshot_handler_test PROPERTIES
    TIMEOUT 60
    LABELS "unit;raft;snapshot;install_snapshot"
)

# Election safety property test
add_executable(raft_election_safety_property_test raft_election_safety_property_test.cpp)
target_link_libraries(raft_election_safety_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_election_safety_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_election_safety_property_test PRIVATE cxx_std_23)
add_test(NAME raft_election_safety_property_test COMMAND raft_election_safety_property_test)

# Higher term follower transition property test
add_executable(raft_higher_term_follower_property_test raft_higher_term_follower_property_test.cpp)
target_link_libraries(raft_higher_term_follower_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_higher_term_follower_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_higher_term_follower_property_test PRIVATE cxx_std_23)
add_test(NAME raft_higher_term_follower_property_test COMMAND raft_higher_term_follower_property_test)

# Log matching property test
add_executable(raft_log_matching_property_test raft_log_matching_property_test.cpp)
target_link_libraries(raft_log_matching_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_log_matching_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_log_matching_property_test PRIVATE cxx_std_23)
add_test(NAME raft_log_matching_property_test COMMAND raft_log_matching_property_test)

# Log convergence property test
add_executable(raft_log_convergence_property_test raft_log_convergence_property_test.cpp)
target_link_libraries(raft_log_convergence_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_log_convergence_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_log_convergence_property_test PRIVATE cxx_std_23)
add_test(NAME raft_log_convergence_property_test COMMAND raft_log_convergence_property_test)

# Heartbeat test
add_executable(raft_heartbeat_test raft_heartbeat_test.cpp)
target_link_libraries(raft_heartbeat_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_heartbeat_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_heartbeat_test PRIVATE cxx_std_23)
add_test(NAME raft_heartbeat_test COMMAND raft_heartbeat_test)

# Leader append-only property test
add_executable(raft_leader_append_only_property_test raft_leader_append_only_property_test.cpp)
target_link_libraries(raft_leader_append_only_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_leader_append_only_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_leader_append_only_property_test PRIVATE cxx_std_23)
add_test(NAME raft_leader_append_only_property_test COMMAND raft_leader_append_only_property_test)

# Commit implies replication property test
add_executable(raft_commit_implies_replication_property_test raft_commit_implies_replication_property_test.cpp)
target_link_libraries(raft_commit_implies_replication_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_commit_implies_replication_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_commit_implies_replication_property_test PRIVATE cxx_std_23)
add_test(NAME raft_commit_implies_replication_property_test COMMAND raft_commit_implies_replication_property_test)

# State machine safety property test
add_executable(raft_state_machine_safety_property_test raft_state_machine_safety_property_test.cpp)
target_link_libraries(raft_state_machine_safety_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_state_machine_safety_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_state_machine_safety_property_test PRIVATE cxx_std_23)
add_test(NAME raft_state_machine_safety_property_test COMMAND raft_state_machine_safety_property_test)

# Leader completeness property test
add_executable(raft_leader_completeness_property_test raft_leader_completeness_property_test.cpp)
target_link_libraries(raft_leader_completeness_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_leader_completeness_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_leader_completeness_property_test PRIVATE cxx_std_23)
add_test(NAME raft_leader_completeness_property_test COMMAND raft_leader_completeness_property_test)

# Linearizable operations property test
add_executable(raft_linearizable_operations_property_test raft_linearizable_operations_property_test.cpp)
target_link_libraries(raft_linearizable_operations_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_linearizable_operations_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_linearizable_operations_property_test PRIVATE cxx_std_23)
add_test(NAME raft_linearizable_operations_property_test COMMAND raft_linearizable_operations_property_test)

# Duplicate detection property test
add_executable(raft_duplicate_detection_property_test raft_duplicate_detection_property_test.cpp)
target_link_libraries(raft_duplicate_detection_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_duplicate_detection_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_duplicate_detection_property_test PRIVATE cxx_std_23)
add_test(NAME raft_duplicate_detection_property_test COMMAND raft_duplicate_detection_property_test)

# Snapshot preserves state property test
add_executable(raft_snapshot_preserves_state_property_test raft_snapshot_preserves_state_property_test.cpp)
target_link_libraries(raft_snapshot_preserves_state_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_snapshot_preserves_state_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_snapshot_preserves_state_property_test PRIVATE cxx_std_23)
add_test(NAME raft_snapshot_preserves_state_property_test COMMAND raft_snapshot_preserves_state_property_test)

# Joint consensus majority property test
add_executable(raft_joint_consensus_majority_property_test raft_joint_consensus_majority_property_test.cpp)
target_link_libraries(raft_joint_consensus_majority_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_joint_consensus_majority_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_joint_consensus_majority_property_test PRIVATE cxx_std_23)
add_test(NAME raft_joint_consensus_majority_property_test COMMAND raft_joint_consensus_majority_property_test)

# State transition logging property test
add_executable(raft_state_transition_logging_property_test raft_state_transition_logging_property_test.cpp)
target_link_libraries(raft_state_transition_logging_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_state_transition_logging_property_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_state_transition_logging_property_test PRIVATE cxx_std_23)
add_test(NAME raft_state_transition_logging_property_test COMMAND raft_state_transition_logging_property_test)

# Integration tests
# Async command submission integration test
add_executable(raft_async_command_submission_integration_test raft_async_command_submission_integration_test.cpp)
target_link_libraries(raft_async_command_submission_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_async_command_submission_integration_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_async_command_submission_integration_test PRIVATE cxx_std_23)
add_test(NAME raft_async_command_submission_integration_test COMMAND raft_async_command_submission_integration_test)
set_tests_properties(raft_async_command_submission_integration_test PROPERTIES
    TIMEOUT 300
    LABELS "integration;raft;async;command_submission"
)

# Application failure recovery integration test
add_executable(raft_application_failure_recovery_integration_test raft_application_failure_recovery_integration_test.cpp)
target_link_libraries(raft_application_failure_recovery_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_application_failure_recovery_integration_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_application_failure_recovery_integration_test PRIVATE cxx_std_23)
add_test(NAME raft_application_failure_recovery_integration_test COMMAND raft_application_failure_recovery_integration_test)
set_tests_properties(raft_application_failure_recovery_integration_test PROPERTIES
    TIMEOUT 300
    LABELS "integration;raft;application;failure_recovery"
)

# Timeout classification integration test
add_executable(raft_timeout_classification_integration_test raft_timeout_classification_integration_test.cpp)
target_link_libraries(raft_timeout_classification_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_timeout_classification_integration_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_timeout_classification_integration_test PRIVATE cxx_std_23)
add_test(NAME raft_timeout_classification_integration_test COMMAND raft_timeout_classification_integration_test)
set_tests_properties(raft_timeout_classification_integration_test PROPERTIES
    TIMEOUT 300
    LABELS "integration;raft;timeout;classification"
)

# Retry logic with exponential backoff integration test
add_executable(raft_retry_logic_exponential_backoff_integration_test raft_retry_logic_exponential_backoff_integration_test.cpp)
target_link_libraries(raft_retry_logic_exponential_backoff_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_retry_logic_exponential_backoff_integration_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_retry_logic_exponential_backoff_integration_test PRIVATE cxx_std_23)
add_test(NAME raft_retry_logic_exponential_backoff_integration_test COMMAND raft_retry_logic_exponential_backoff_integration_test)
set_tests_properties(raft_retry_logic_exponential_backoff_integration_test PROPERTIES
    TIMEOUT 300
    LABELS "integration;raft;retry;exponential_backoff"
)

# CoAP integration test
add_executable(coap_integration_test coap_integration_test.cpp)
target_link_libraries(coap_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_integration_test PRIVATE Folly::folly)
endif()

# Add CoAP transport dependencies
find_package(PkgConfig QUIET)
if(PkgConfig_FOUND)
    pkg_check_modules(LIBCOAP QUIET libcoap-3)
    if(LIBCOAP_FOUND)
        target_link_libraries(coap_integration_test PRIVATE ${LIBCOAP_LIBRARIES})
        target_include_directories(coap_integration_test PRIVATE ${LIBCOAP_INCLUDE_DIRS})
        target_compile_definitions(coap_integration_test PRIVATE ${LIBCOAP_CFLAGS_OTHER})
    endif()
endif()

# Link OpenSSL for DTLS support
if(TARGET OpenSSL::SSL)
    target_link_libraries(coap_integration_test PRIVATE OpenSSL::SSL OpenSSL::Crypto)
endif()

target_compile_features(coap_integration_test PRIVATE cxx_std_23)
add_test(NAME coap_integration_test COMMAND coap_integration_test)

# CoAP concurrent processing property test needs Boost.JSON
add_executable(coap_concurrent_processing_property_test coap_concurrent_processing_property_test.cpp)
target_link_libraries(coap_concurrent_processing_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_concurrent_processing_property_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_concurrent_processing_property_test PRIVATE cxx_std_23)
add_test(NAME coap_concurrent_processing_property_test COMMAND coap_concurrent_processing_property_test)

# CoAP connection reuse property test needs Boost.JSON
add_executable(coap_connection_reuse_property_test coap_connection_reuse_property_test.cpp)
target_link_libraries(coap_connection_reuse_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_connection_reuse_property_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_connection_reuse_property_test PRIVATE cxx_std_23)
add_test(NAME coap_connection_reuse_property_test COMMAND coap_connection_reuse_property_test)

# CoAP multicast delivery property test needs Boost.JSON
add_executable(coap_multicast_delivery_property_test coap_multicast_delivery_property_test.cpp)
target_link_libraries(coap_multicast_delivery_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_multicast_delivery_property_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_multicast_delivery_property_test PRIVATE cxx_std_23)
add_test(NAME coap_multicast_delivery_property_test COMMAND coap_multicast_delivery_property_test)

# CoAP real block transfer property test needs Boost.JSON
add_executable(coap_real_block_transfer_property_test coap_real_block_transfer_property_test.cpp)
target_link_libraries(coap_real_block_transfer_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_real_block_transfer_property_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_real_block_transfer_property_test PRIVATE cxx_std_23)
add_test(NAME coap_real_block_transfer_property_test COMMAND coap_real_block_transfer_property_test)
set_tests_properties(coap_real_block_transfer_property_test PROPERTIES
    TIMEOUT 180
    LABELS "property;coap;block_transfer"
)

# CoAP enhanced block transfer test
add_executable(coap_enhanced_block_transfer_test coap_enhanced_block_transfer_test.cpp)
target_link_libraries(coap_enhanced_block_transfer_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
target_compile_features(coap_enhanced_block_transfer_test PRIVATE cxx_std_23)
add_test(NAME coap_enhanced_block_transfer_test COMMAND coap_enhanced_block_transfer_test)
set_tests_properties(coap_enhanced_block_transfer_test PROPERTIES
    TIMEOUT 120
    LABELS "unit;coap;block_transfer;enhanced"
)

# HTTP SSL Configuration Property Tests
add_executable(http_ssl_configuration_property_test http_ssl_configuration_property_test.cpp)
target_link_libraries(http_ssl_configuration_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
if(TARGET Folly::folly)
    target_link_libraries(http_ssl_configuration_property_test PRIVATE Folly::folly)
endif()
if(TARGET httplib::httplib)
    target_link_libraries(http_ssl_configuration_property_test PRIVATE httplib::httplib)
endif()
if(TARGET OpenSSL::SSL)
    target_link_libraries(http_ssl_configuration_property_test PRIVATE OpenSSL::SSL OpenSSL::Crypto)
endif()
target_compile_features(http_ssl_configuration_property_test PRIVATE cxx_std_23)
add_test(NAME http_ssl_configuration_property_test COMMAND http_ssl_configuration_property_test)
set_tests_properties(http_ssl_configuration_property_test PROPERTIES
    TIMEOUT 60
    LABELS "property;ssl;http;transport"
)

# HTTP SSL Certificate Loading Unit Tests
add_executable(http_ssl_certificate_loading_unit_test http_ssl_certificate_loading_unit_test.cpp)
target_link_libraries(http_ssl_certificate_loading_unit_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
if(TARGET Folly::folly)
    target_link_libraries(http_ssl_certificate_loading_unit_test PRIVATE Folly::folly)
endif()
if(TARGET httplib::httplib)
    target_link_libraries(http_ssl_certificate_loading_unit_test PRIVATE httplib::httplib)
endif()
if(TARGET OpenSSL::SSL)
    target_link_libraries(http_ssl_certificate_loading_unit_test PRIVATE OpenSSL::SSL OpenSSL::Crypto)
endif()
target_compile_features(http_ssl_certificate_loading_unit_test PRIVATE cxx_std_23)
add_test(NAME http_ssl_certificate_loading_unit_test COMMAND http_ssl_certificate_loading_unit_test)
set_tests_properties(http_ssl_certificate_loading_unit_test PROPERTIES
    TIMEOUT 30
    LABELS "unit;ssl;certificate;http;transport"
)

# HTTP SSL Context Configuration Unit Tests
add_executable(http_ssl_context_configuration_unit_test http_ssl_context_configuration_unit_test.cpp)
target_link_libraries(http_ssl_context_configuration_unit_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
if(TARGET Folly::folly)
    target_link_libraries(http_ssl_context_configuration_unit_test PRIVATE Folly::folly)
endif()
if(TARGET httplib::httplib)
    target_link_libraries(http_ssl_context_configuration_unit_test PRIVATE httplib::httplib)
endif()
if(TARGET OpenSSL::SSL)
    target_link_libraries(http_ssl_context_configuration_unit_test PRIVATE OpenSSL::SSL OpenSSL::Crypto)
endif()
target_compile_features(http_ssl_context_configuration_unit_test PRIVATE cxx_std_23)
add_test(NAME http_ssl_context_configuration_unit_test COMMAND http_ssl_context_configuration_unit_test)
set_tests_properties(http_ssl_context_configuration_unit_test PROPERTIES
    TIMEOUT 30
    LABELS "unit;ssl;context;http;transport"
)

# HTTP SSL Mutual TLS Integration Tests
add_executable(http_ssl_mutual_tls_integration_test http_ssl_mutual_tls_integration_test.cpp)
target_link_libraries(http_ssl_mutual_tls_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
if(TARGET Folly::folly)
    target_link_libraries(http_ssl_mutual_tls_integration_test PRIVATE Folly::folly)
endif()
if(TARGET httplib::httplib)
    target_link_libraries(http_ssl_mutual_tls_integration_test PRIVATE httplib::httplib)
endif()
if(TARGET OpenSSL::SSL)
    target_link_libraries(http_ssl_mutual_tls_integration_test PRIVATE OpenSSL::SSL OpenSSL::Crypto)
endif()
target_compile_features(http_ssl_mutual_tls_integration_test PRIVATE cxx_std_23)
add_test(NAME http_ssl_mutual_tls_integration_test COMMAND http_ssl_mutual_tls_integration_test)
set_tests_properties(http_ssl_mutual_tls_integration_test PROPERTIES
    TIMEOUT 120
    LABELS "integration;ssl;mutual_tls;http;transport"
)

# Additional CoAP tests that were missing
add_executable(coap_cipher_suite_property_test coap_cipher_suite_property_test.cpp)
target_link_libraries(coap_cipher_suite_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_cipher_suite_property_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_cipher_suite_property_test PRIVATE cxx_std_23)
add_test(NAME coap_cipher_suite_property_test COMMAND coap_cipher_suite_property_test)
set_tests_properties(coap_cipher_suite_property_test PROPERTIES
    TIMEOUT 120
    LABELS "property;coap;dtls;cipher_suite"
)

add_executable(coap_dtls_handshake_property_test coap_dtls_handshake_property_test.cpp)
target_link_libraries(coap_dtls_handshake_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_dtls_handshake_property_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_dtls_handshake_property_test PRIVATE cxx_std_23)
add_test(NAME coap_dtls_handshake_property_test COMMAND coap_dtls_handshake_property_test)
set_tests_properties(coap_dtls_handshake_property_test PROPERTIES
    TIMEOUT 120
    LABELS "property;coap;dtls;handshake"
)

add_executable(coap_thread_safety_property_test coap_thread_safety_property_test.cpp)
target_link_libraries(coap_thread_safety_property_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(coap_thread_safety_property_test PRIVATE Folly::folly)
endif()
target_compile_features(coap_thread_safety_property_test PRIVATE cxx_std_23)
add_test(NAME coap_thread_safety_property_test COMMAND coap_thread_safety_property_test)
set_tests_properties(coap_thread_safety_property_test PROPERTIES
    TIMEOUT 180
    LABELS "property;coap;thread_safety;concurrency"
)

# Namespace consistency property test
add_network_test(namespace_consistency_property_test namespace_consistency_property_test.cpp)

# Debug accept test (not registered as it's for debugging only)
add_executable(debug_accept_test debug_accept_test.cpp)
target_link_libraries(debug_accept_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
if(TARGET Folly::folly)
    target_link_libraries(debug_accept_test PRIVATE Folly::folly)
endif()
target_compile_features(debug_accept_test PRIVATE cxx_std_23)
# Note: debug_accept_test is not added to CTest as it's for manual debugging only

# Counter state machine test (example state machine)
add_executable(counter_state_machine_test counter_state_machine_test.cpp)
target_link_libraries(counter_state_machine_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
target_compile_features(counter_state_machine_test PRIVATE cxx_std_23)
add_test(NAME counter_state_machine_test COMMAND counter_state_machine_test)
set_tests_properties(counter_state_machine_test PROPERTIES
    TIMEOUT 30
    LABELS "unit;state_machine;example"
)

# Register state machine test (example state machine)
add_executable(register_state_machine_test register_state_machine_test.cpp)
target_link_libraries(register_state_machine_test PRIVATE
    network_simulator
    Boost::unit_test_framework
)
target_compile_features(register_state_machine_test PRIVATE cxx_std_23)
add_test(NAME register_state_machine_test COMMAND register_state_machine_test)
set_tests_properties(register_state_machine_test PROPERTIES
    TIMEOUT 30
    LABELS "unit;state_machine;example"
)

# State machine integration test (end-to-end command application)
add_executable(raft_state_machine_integration_test raft_state_machine_integration_test.cpp)
target_link_libraries(raft_state_machine_integration_test PRIVATE
    network_simulator
    Boost::unit_test_framework
    boost_json
)
if(TARGET Folly::folly)
    target_link_libraries(raft_state_machine_integration_test PRIVATE Folly::folly)
endif()
target_compile_features(raft_state_machine_integration_test PRIVATE cxx_std_23)
add_test(NAME raft_state_machine_integration_test COMMAND raft_state_machine_integration_test)
set_tests_properties(raft_state_machine_integration_test PROPERTIES
    TIMEOUT 60
    LABELS "integration;state_machine;raft"
)
